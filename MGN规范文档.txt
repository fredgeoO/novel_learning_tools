# Markdown 图谱语法规范（MGN）  
**版本 1.2**  
**一种在 Markdown 中表达通用图结构的人类可读语法**

---

<!--  
Copyright (c) 2025, FredgeoO
保留所有权利。

在满足以下条件的情况下，允许以源代码和二进制形式重新分发和使用，无论是否修改：

1. 源代码的再分发必须保留上述版权声明、本条件列表和以下免责声明。

2. 二进制形式的再分发必须在分发所提供的文档和/或其他材料中重现上述版权声明、本条件列表和以下免责声明。

本规范“按原样”提供，版权持有人和贡献者明确放弃所有明示或暗示的保证，包括但不限于适销性和特定用途适用性的暗示保证。在任何情况下，版权持有人或贡献者均不对任何直接、间接、偶然、特殊、示范性或后果性损害（包括但不限于替代商品或服务的采购、使用损失、数据损失或利润损失，或业务中断）承担责任，无论该等损害是如何引起的，也无论其责任理论如何，即使已被告知可能发生此类损害。
-->

---

## 1. 简介

**Markdown 图谱语法（MGN）** 是一种轻量级语法，用于在标准 Markdown 文档中嵌入**通用图结构**（节点与关系）。

- ✅ **100% 兼容 CommonMark**  
- ✅ **人类可读**：文档仍是自然语言  
- ✅ **机器可解析**：可提取完整的属性图  
- ✅ **通用性强**：支持类型化节点、唯一标识、有向/无向边  
- ✅ **上下文感知**：通过作用域减少冗余  

MGN 使文档**既是叙述，又是结构**——写作即建模。

---

## 2. 设计原则

1. **Markdown 优先**：不使用自定义块，仅用内联语法  
2. **渐进增强**：简单场景无需类型或 ID  
3. **往返无损**：解析后可还原原始文本  
4. **Unicode 友好**：支持全角与半角符号  
5. **开放免费**：采用 2-Clause BSD 许可证（见顶部）

---

## 3. 核心语法

### 3.1 节点

节点由标签和可选的类型、唯一标识组成：

| 语法 | 说明 |
|------|------|
| `标签` | 基础节点（ID = 标签） |
| `标签:类型` | 带语义类型的节点 |
| `标签::ID` | 带显式唯一标识的节点 |
| `标签:类型::ID` | 同时带类型和 ID 的节点 |

**规则**：
- `标签`、`类型`、`ID` 为**不含空格及 `:`, `-`, `[`, `]` 的字符串**
- **支持全角符号**（如中文环境）：  
  示例：`爱因斯坦：人物：：einstein` ≡ `爱因斯坦:人物::einstein`
- 若省略 `::ID`，节点 ID 默认为 `标签`

---

### 3.2 关系

#### 有向关系
```markdown
[源节点 -关系类型-> 目标节点]
```

#### 无向关系
```markdown
[源节点 -关系类型- 目标节点]
```

**规则**：
- `源节点` 和 `目标节点` 遵循节点语法（§3.1）
- `关系类型` 为语义动词或短语（如 `创立`、`位于`）
- **支持全角连字符**（如 `－`），但推荐使用半角 `-`

---

### 3.3 上下文简写形式

在标题上下文（`#`、`##` 等）中，可省略源节点：

```markdown
## 当前主体[:类型][::ID]

[-关系类型-> 目标节点[:类型][::ID]]
```

→ 等价于：  
`[当前主体 -关系类型-> 目标节点]`

**规则**：
- 当前主体为**最近一个标题的文本**
- 标题主体可包含类型/ID：`## 爱因斯坦:人物::einstein`

---

## 4. 示例

### 4.1 基础用法
```markdown
[爱因斯坦 -创立-> 相对论]  
[瑞士 -位于-> 欧洲]
```

### 4.2 带类型
```markdown
[爱因斯坦:人物 -创立-> 相对论:理论]  
[诺贝尔奖:奖项 -颁发于-> 1921年:时间]
```

### 4.3 唯一标识（用于消歧）
```markdown
[公司A::comp_001 -竞争-> 公司A::comp_002]  
[苹果::fruit -不同於-> 苹果::company]
```

### 4.4 无向关系
```markdown
[爱因斯坦 -合作- 罗素]  
[北京 -邻接- 河北]
```

### 4.5 上下文简写
```markdown
## 爱因斯坦:人物::einstein

[-创立-> 狭义相对论:理论]  
[-获得-> 诺贝尔物理学奖:奖项]
```

### 4.6 全角符号兼容（合法但不推荐）
```markdown
[爱因斯坦：人物：：einstein －创立－ 相对论：理论]
```

---

## 5. 解析规则

### 5.1 节点解析
节点字符串按以下正则解析：
```regex
^([^:\-\[\]\s]+)(?::([^:\-\[\]\s]*))?(?:::([^:\-\[\]\s]*))?$
```
- 第1组：`标签`（必需）
- 第2组：`类型`（可选）
- 第3组：`ID`（可选）

若无 `ID`，则 `ID = 标签`。

### 5.2 关系解析
- **有向关系**：  
  `$$$(.+?)\s*-\s*(.+?)\s*->\s*(.+?)$$$`
- **无向关系**：  
  `$$$(.+?)\s*-\s*(.+?)\s*-\s*(.+?)$$$`

### 5.3 上下文跟踪
- 遇到标题 `# X` 时，设 `current_subject = X`
- 简写关系 `[-R-> T]` 解析为 `(current_subject, R, T)`

---

## 6. 输出图模型

MGN 解析结果为**属性图**，包含：

```ts
interface 节点 {
  id: string;      // 唯一标识（来自 ::ID 或 标签）
  label: string;   // 显示名称
  type?: string;   // 可选语义类型
}

interface 关系 {
  source: string;  // 源节点 ID
  target: string;  // 目标节点 ID
  type: string;    // 关系类型
  directed: boolean; // 有向为 true（->），无向为 false（-）
}
```

---

## 7. 兼容性与工具支持

| 环境 | 行为 |
|------|------|
| **GitHub / GitLab** | 渲染为普通文本，无特殊处理 |
| **Obsidian / Logseq** | 安全；不影响 `[[ ]]` 链接 |
| **标准 Markdown** | 完全兼容，无渲染错误 |
| **纯文本** | 可读作带注释的叙述 |

---

## 8. 应用场景

- 个人知识管理（PKM）  
- LLM 结构化输出生成  
- 轻量级知识图谱编写  
- 文档内嵌依赖关系图  
- 学术笔记中的语义链接  

---

## 9. 参考

- [CommonMark 规范](https://commonmark.org)  
- 受 Markdown 启发（John Gruber, 2004）  
- 属性图模型（PyVis, Vis.js）

---

> **“最好的图谱语法，是你忘记自己正在使用的语法。”**  
> — MGN 设计哲学

---  
*本规范采用 2-Clause BSD 许可证。详见文档顶部。*
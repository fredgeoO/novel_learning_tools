第7章 老乔

田行健在心中默默给自己儿子打气的时候，一位叫做乔一阳的程序员主管终于还是按捺不住了。

　　这位主管是刚从别的公司跳槽过来，因为那家公司在业内的地位比天行网路高不少，加上他的履历很好看，有不少项目成功的经历，因此性格古怪，恃才傲物。

　　只见他腾的一声站起身子，开口道：

　　“老田，我性子比较直，如果后面说的话惹的你不高兴了，我先道个歉。”

　　接着他没有等田行健有所反应，便丝毫不客气的继续说道：

　　“你在扯什么淡呢？”

　　“是，公司你是全资大股东，你砸你自己的钱，培养儿子，那是你的自由，如果是在别的方面，比如送儿子去外国深造，或者去别的地方什么学习，我举双手赞成。”

　　“但是！”

　　乔一阳加重了声音，此时会议室里的其他人也停下了议论声，都齐刷刷的看向了他。

　　“项目不是儿戏，我到这里是来工作赚钱的，没有心情陪小孩子过家家。”

　　“你要改革我没意见，只要钱不少我的，我照样给你干活，但是，你在公司拿100W给一个刚上大学的小屁孩打水漂？“

　　“他有那个技术吗？有那个能力吗？他做的明白吗？”

　　“多的不说，少的不唠，你拿100W预算给我，我有把握能再给你干出一个搜神记那样的爆款项目。”

　　“老田你自己考虑清楚。”

　　说完乔一阳重新坐回了自己的座位，双手抱在胸前，直勾勾的注视着田行健。

　　众人谁也没有接话，乔一阳说的也是他们的心声，他们不少人也觉得让田手办这样一个学生仔开一个项目实在有些不靠谱。

　　即便有几个人觉得能去新项目吃几个月无责任底薪也不错，但是终究没有接话。

　　大佬斗法，他们这些小喽啰还是不要插嘴了。

　　就连田行健也有点反思自己是不是太过于急于想利用系统薅羊毛而忽略其他人感受的时候，田手办却开口说话了。

　　“乔——主管，我刚刚进来的时候，看到白板上写着VIP充值延迟的BUG，对吧？”

　　这话题之间的跨越度之大一时间让乔一阳有些反应不过来，错愕迟疑了一下以后还是点头回道。

　　“嗯，部分充值请求阻塞在t_payment表……”

　　就在这时候，会议室的门突然被推开，正是轮到今天值班的张凯。

　　他感觉此时会议室内的氛围有些奇怪，但是情况紧急，他也顾不了那么多了，直接开口说道：

　　“老板，紧急状况！现在已经有上百名VIP用户通过客服反馈充值不到账，其中还有几位重度用户。”

　　“刚刚检查了CDN，还有支付接口，所有支付回调都卡在写入游戏日志这步。”

　　“但阿里云监控显示MySQL负载才到40%...“

　　张凯的话让会议室再度陷入骚动。

　　VIP客户以及重度用户一直是他们这种网页游戏的立身之本，几名重度用户的氪金量就能养活一个服务器，如果这些重度用户因为充值问题流失，甚至减少以后充值的意愿，那就是大事故了。

　　毕竟人家想充钱都充不痛快，那还有什么理由继续玩呢？

　　再严重点，有人如果趁机带节奏，抹黑他们公司是骗子公司，充钱了不给东西，那对于公司的品牌信誉都会产生危机。

　　田行健倒是心中一喜，他巴不得现在多出一些这种恶性bug降低一下他的收入，让他能成功亏钱，但是现在这个场合实在不好表现出来，加上刚刚乔一阳的话他实在有些不知道怎么接，便只能开口道：

　　“咳，老乔，你先去解决一下……”

　　他的话还还没有说完，就看到田手办站起了身子，直接走出了会议室，帆布鞋在地面蹭出短促的摩擦音，而乔一阳也马上站起了身子，跟在了后面。

　　其他几个程序员也陆续起身，走出了会议室。

　　“能看看binlog吗？“田手办说这话时已经来到了乔一阳的工位上，手指也没有停歇，握上了鼠标，开始检索。

　　他的动作非常快，无比娴熟，乔一阳还没有反应过来，便已经完成了检索。

　　双眼凝视，红色的半透明边框在视野中浮现，流动的金色粒子轨迹很快帮田手办锁定了问题所在。

　　“复合索引缺失会导致高频交易的死锁，尤其在innodb的默认隔离级别下。“

　　满室的寂静中，乔一阳感觉自己的青筋在太阳穴附近跳动。

　　这个问题昨天他就发现了，但是一直没有很好的解决办法，难道……

　　“乔主管，我需要临时的管理员权限。“田手办闭上了眼，几个呼吸之后再次睁眼，在转向运维组的显示器的同时说道，同时目光牢牢锁住了墙上跳动的Zabbix监控图——那里有三条红色的load average曲线，像毒蛇般噬咬着CPU使用率。

　　“两天前你们把t_payment表从MyISAM转成InnoDB，但没有调整transaction隔离级别。“

　　“给我五分钟，我可以让充值响应时间从8秒降到800毫秒。“

　　他声音很轻，却透露着绝对的自信。

　　乔一阳听到这话后瞳孔猛地收缩。这个操作是他为了提升写入性能私下做的，甚至没提交到git仓库。

　　鬼使神差的，他伏下了身子，他为田手办输入了开启权限的密码。

　　这不符合章程，而且自己刚刚还在会议室里嘲讽对方的年纪。

　　但是这小鬼又一下子直指了问题核心。

　　不应该啊……他明明才刚上大学……

　　键盘被敲打的噼啪作响，白皙的手指上下翻飞。

　　当田手办ssh跳转到备库时，他的Terminal窗口突然分裂成三个tmux面板。

　　“找到了。“田手办按下Ctrl+C，光标停在一段代码上：

　　是裸拼SQL字符串导致的潜在注入漏洞与锁缺失。

　　更致命的是t_payment表的索引结构：

　　缺乏（user_id，status）复合索引导致大量全表扫描。

　　当田手办在vim里敲下第三段存储过程时，突然闻到淡淡的桂花味道。

　　他身后不知何时多了个穿深灰色衬衫的男人，镜片后的眼睛盯着屏幕上一闪而过的explain执行计划。

　　“把t_payment的status字段拆成两个冗余列？“

　　“用memory引擎做实时缓冲表……这是谁教你的优化思路？用redis解决实时缓冲表，这确实是当前状况的最优解了。“

　　男人突然开口时，站在田手办身旁的乔一阳猛然转过头。

　　这个声音……

　　是他请来的外援。
<!-- templates/text_view.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">

</head>
<body>
 <!-- 在图谱容器之前添加 -->
<div class="tab-content mt-3">
    <!-- 图谱视图 -->
    <div class="tab-pane fade show active" id="tab-viewer">
        <div class="row">
            <!-- 主图谱区域 -->
            <div class="col-md-9">
                <div class="graph-container">
                    <div id="graph-content" style="width: 100%; height: 100%; overflow: hidden;">
                        <div class="text-center p-5 text-white">
                            <div class="spinner-border text-light" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <p class="mt-2">正在加载图谱...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧控制面板 -->
            <div class="col-md-3">
                <div class="sidebar">
                    <!-- 显示控制 -->
                    <div class="control-panel">
                        <h5>📊 显示控制</h5>
                        <div class="mb-3">
                            <label class="form-label">最大节点数</label>
                            <input type="number" class="form-control" id="max-nodes" value="1000" min="1" max="2000">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">最大边数</label>
                            <input type="number" class="form-control" id="max-edges" value="1000" min="1" max="2000">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="physics-enabled" checked>
                            <label class="form-check-label" for="physics-enabled">启用物理效果</label>
                        </div>
                        <button id="apply-settings" class="btn btn-success w-100">应用设置</button>
                        <button id="refresh-btn" class="btn btn-primary w-100 mt-2">🔄 刷新</button>
                    </div>

                    <!-- 节点类型控制 -->
                    <div class="control-panel">
                        <h5>🎨 节点类型控制</h5>
                        <div id="color-legend-controls"></div>
                        <button id="refresh-graph-types" class="btn btn-warning w-100 mt-2">刷新图谱</button>
                    </div>

                    <!-- 元数据 -->
                    <div class="control-panel">
                        <h5>📋 图谱信息</h5>
                        <div id="metadata-info">加载中...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 选择器视图 -->
    <div class="tab-pane fade" id="tab-selector">
        <div id="selector-content">
            <!-- 选择器内容将通过 AJAX 加载 -->
            <div class="text-center p-5">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
                <p class="mt-2">正在加载选择器...</p>
            </div>
        </div>
    </div>

    <!-- 文字版视图 -->
    <div class="tab-pane fade" id="tab-text">
        <div id="text-content">
            <!-- 文字版内容将通过 AJAX 加载 -->
            <div class="text-center p-5">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
                <p class="mt-2">正在加载文字版...</p>
            </div>
        </div>
    </div>
</div>

    <script>
        const cacheKey = '{{ cache_key }}';

        async function loadTextContent() {
            try {
                const response = await fetch(`/api/graph/${encodeURIComponent(cacheKey)}/text`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '加载失败');
                }

                document.getElementById('text-content').innerHTML =
                    `<pre style="white-space: pre-wrap; font-family: monospace;">${data.content}</pre>`;
            } catch (error) {
                document.getElementById('text-content').innerHTML =
                    `<div class="alert alert-danger">加载失败: ${error.message}</div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadTextContent);
    </script>
</body>
</html>
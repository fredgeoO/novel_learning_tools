<!-- templates/text_view.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">

</head>
<body>
 <!-- åœ¨å›¾è°±å®¹å™¨ä¹‹å‰æ·»åŠ  -->
<div class="tab-content mt-3">
    <!-- å›¾è°±è§†å›¾ -->
    <div class="tab-pane fade show active" id="tab-viewer">
        <div class="row">
            <!-- ä¸»å›¾è°±åŒºåŸŸ -->
            <div class="col-md-9">
                <div class="graph-container">
                    <div id="graph-content" style="width: 100%; height: 100%; overflow: hidden;">
                        <div class="text-center p-5 text-white">
                            <div class="spinner-border text-light" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-2">æ­£åœ¨åŠ è½½å›¾è°±...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="col-md-3">
                <div class="sidebar">
                    <!-- æ˜¾ç¤ºæ§åˆ¶ -->
                    <div class="control-panel">
                        <h5>ğŸ“Š æ˜¾ç¤ºæ§åˆ¶</h5>
                        <div class="mb-3">
                            <label class="form-label">æœ€å¤§èŠ‚ç‚¹æ•°</label>
                            <input type="number" class="form-control" id="max-nodes" value="1000" min="1" max="2000">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æœ€å¤§è¾¹æ•°</label>
                            <input type="number" class="form-control" id="max-edges" value="1000" min="1" max="2000">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="physics-enabled" checked>
                            <label class="form-check-label" for="physics-enabled">å¯ç”¨ç‰©ç†æ•ˆæœ</label>
                        </div>
                        <button id="apply-settings" class="btn btn-success w-100">åº”ç”¨è®¾ç½®</button>
                        <button id="refresh-btn" class="btn btn-primary w-100 mt-2">ğŸ”„ åˆ·æ–°</button>
                    </div>

                    <!-- èŠ‚ç‚¹ç±»å‹æ§åˆ¶ -->
                    <div class="control-panel">
                        <h5>ğŸ¨ èŠ‚ç‚¹ç±»å‹æ§åˆ¶</h5>
                        <div id="color-legend-controls"></div>
                        <button id="refresh-graph-types" class="btn btn-warning w-100 mt-2">åˆ·æ–°å›¾è°±</button>
                    </div>

                    <!-- å…ƒæ•°æ® -->
                    <div class="control-panel">
                        <h5>ğŸ“‹ å›¾è°±ä¿¡æ¯</h5>
                        <div id="metadata-info">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€‰æ‹©å™¨è§†å›¾ -->
    <div class="tab-pane fade" id="tab-selector">
        <div id="selector-content">
            <!-- é€‰æ‹©å™¨å†…å®¹å°†é€šè¿‡ AJAX åŠ è½½ -->
            <div class="text-center p-5">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">åŠ è½½ä¸­...</span>
                </div>
                <p class="mt-2">æ­£åœ¨åŠ è½½é€‰æ‹©å™¨...</p>
            </div>
        </div>
    </div>

    <!-- æ–‡å­—ç‰ˆè§†å›¾ -->
    <div class="tab-pane fade" id="tab-text">
        <div id="text-content">
            <!-- æ–‡å­—ç‰ˆå†…å®¹å°†é€šè¿‡ AJAX åŠ è½½ -->
            <div class="text-center p-5">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">åŠ è½½ä¸­...</span>
                </div>
                <p class="mt-2">æ­£åœ¨åŠ è½½æ–‡å­—ç‰ˆ...</p>
            </div>
        </div>
    </div>
</div>

    <script>
        const cacheKey = '{{ cache_key }}';

        async function loadTextContent() {
            try {
                const response = await fetch(`/api/graph/${encodeURIComponent(cacheKey)}/text`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'åŠ è½½å¤±è´¥');
                }

                document.getElementById('text-content').innerHTML =
                    `<pre style="white-space: pre-wrap; font-family: monospace;">${data.content}</pre>`;
            } catch (error) {
                document.getElementById('text-content').innerHTML =
                    `<div class="alert alert-danger">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadTextContent);
    </script>
</body>
</html>